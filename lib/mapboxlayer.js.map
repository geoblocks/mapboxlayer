{"version":3,"file":"mapboxlayer.js","sources":["../../src/MapBoxLayer.js"],"sourcesContent":["import Layer from 'ol/layer/Layer'\nimport {toDegrees} from 'ol/math';\nimport {toLonLat} from 'ol/proj.js';\n\nimport mapboxgl from 'mapbox-gl';\n\n/**\n * @typedef {Object} Options\n * @property {string} [accessToken]\n * @property {string} style\n * @property {string|HTMLElement} container\n */\n\n\nexport default class MapBox extends Layer {\n\n  /**\n   * @param {Options} options\n   */\n  constructor(options) {\n\n    const baseOptions = Object.assign({}, options);\n\n    delete baseOptions.accessToken;\n    delete baseOptions.style;\n    delete baseOptions.container;\n    super(baseOptions);\n\n    if (options.accessToken) {\n      mapboxgl.accessToken = options.accessToken;\n    }\n\n    this.map_ = new mapboxgl.Map({\n      container: options.container,\n      style: options.style,\n      attributionControl: false,\n      boxZoom: false,\n      doubleClickZoom: false,\n      dragPan: false,\n      dragRotate: false,\n      interactive: false,\n      keyboard: false,\n      pitchWithRotate: false,\n      scrollZoom: false,\n      touchZoomRotate: false\n    });\n  }\n\n  /**\n   * @param {import('ol/PluggableMap').FrameState} frameState\n   */\n  render(frameState) {\n    const canvas = this.map_.getCanvas();\n    const viewState = frameState.viewState;\n\n    const visible = this.getVisible();\n    canvas.style.display = visible ? 'block' : 'none';\n\n    const opacity = this.getOpacity().toString();\n    if (opacity !== canvas.style.opacity) {\n      canvas.style.opacity = opacity;\n    }\n\n    // adjust view parameters in mapbox\n    const rotation = viewState.rotation;\n    if (rotation) {\n      this.map_.rotateTo(toDegrees(-rotation), {\n        animate: false\n      });\n    }\n    this.map_.jumpTo({\n      center: toLonLat(viewState.center),\n      zoom: viewState.zoom - 1,\n      animate: false\n    });\n\n    // cancel the scheduled update & trigger synchronous redraw\n    // see https://github.com/mapbox/mapbox-gl-js/issues/7893#issue-408992184\n    // NOTE: THIS MIGHT BREAK WHEN UPDATING MAPBOX\n    if (this.map_._frame) {\n      this.map_._frame.cancel();\n      this.map_._frame = null;\n    }\n    this.map_._render();\n\n    return canvas;\n  }\n\n  /**\n   * @param {string} name\n   * @param {boolean} visible\n   */\n  setLayerVisibility(name, visible) {\n    this.map_.setLayoutProperty(name, 'visibility', visible ? 'visible' : 'none');\n  }\n\n}\n"],"names":["constructor","options","baseOptions","Object","assign","accessToken","style","container","mapboxgl","map_","Map","attributionControl","boxZoom","doubleClickZoom","dragPan","dragRotate","interactive","keyboard","pitchWithRotate","scrollZoom","touchZoomRotate","render","frameState","canvas","this","getCanvas","viewState","visible","getVisible","display","opacity","getOpacity","toString","rotation","rotateTo","toDegrees","animate","jumpTo","center","toLonLat","zoom","_frame","cancel","_render","setLayerVisibility","name","setLayoutProperty","Layer"],"mappings":"4JAmBEA,WAAYC,OAEJC,EAAcC,OAAOC,OAAO,GAAIH,UAE/BC,EAAYG,mBACZH,EAAYI,aACZJ,EAAYK,sBACbL,GAEFD,EAAQI,cACVG,EAASH,YAAcJ,EAAQI,kBAG5BI,KAAO,IAAID,EAASE,IAAI,CAC3BH,UAAWN,EAAQM,UACnBD,MAAOL,EAAQK,MACfK,oBAAoB,EACpBC,SAAS,EACTC,iBAAiB,EACjBC,SAAS,EACTC,YAAY,EACZC,aAAa,EACbC,UAAU,EACVC,iBAAiB,EACjBC,YAAY,EACZC,iBAAiB,oGAOrBC,gBAAOC,OACCC,EAASC,KAAKf,KAAKgB,YACnBC,EAAYJ,EAAWI,UAEvBC,EAAUH,KAAKI,aACrBL,EAAOjB,MAAMuB,QAAUF,EAAU,QAAU,WAErCG,EAAUN,KAAKO,aAAaC,WAC9BF,IAAYP,EAAOjB,MAAMwB,UAC3BP,EAAOjB,MAAMwB,QAAUA,OAInBG,EAAWP,EAAUO,gBACvBA,QACGxB,KAAKyB,SAASC,GAAWF,GAAW,CACvCG,SAAS,SAGR3B,KAAK4B,OAAO,CACfC,OAAQC,EAASb,EAAUY,QAC3BE,KAAMd,EAAUc,KAAO,EACvBJ,SAAS,IAMPZ,KAAKf,KAAKgC,cACPhC,KAAKgC,OAAOC,cACZjC,KAAKgC,OAAS,WAEhBhC,KAAKkC,UAEHpB,eAOTqB,4BAAmBC,EAAMlB,QAClBlB,KAAKqC,kBAAkBD,EAAM,aAAclB,EAAU,UAAY,YA/EtCoB"}